
<!DOCTYPE html>
<html>
<head>
	<title>Lost and Found</title>
  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" />
	<link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic' rel='stylesheet' type='text/css'>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
    #sandbox p {
      display: inline; padding: 5px; margin-right: 5px; background: lightgrey;
    }
    .nar{
      width: 350px; padding: 5px;
    }
    .panel-heading{
      font-weight: bold;
    }
    .badge{
      font-weight: normal;
      background-color: #DDD;
      color: black;
      font-size: large;
    }
    .list-group-item{
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div class='container'>
    <div class='row'>
      <div class='col-md-12'>
        <h1> Lost and Found in the MTA </h1>
      </div>
    </div>
    <div class='row'>
      <div class='col-md-12 results'>
      </div>
    </div>
  </div>
</body>
<script src="https://code.jquery.com/jquery-2.1.4.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/masonry/3.3.0/masonry.pkgd.min.js"></script>
<script>
$(document).ready(function() {

  var data = {
    'name' : 'data',
    'cats' : []
  };

  function parseXML(xml){
    $(xml).find("Category").each(function(){
      var cat = {
        'name' : $(this).attr('Category'),
        'data' : []
      };
      $(this).find("SubCategory").each(function(){
        var subcat = {
          'name' : $(this).attr('SubCategory'),
          'count' : $(this).attr('count')
        };
        cat['data'].push(subcat);
      });
      data['cats'].push(cat);
    });
  };

  $.ajax({
    type: "POST",
    url: "http://jbuckland.com/bounce.php",
    data: "{}",
    contentType: "application/xml; charset=utf-8",
    dataType: "xml",
    success: parseXML
  })
  .done(function()    {
    $("#sandbox").append( "<p>Second Success.</p>"  );

    console.log(data.cats);

    for (var i = 0; i < data['cats'].length; i++){
      $('.results').append("<div class='nar' id='"+i+"'> </div>");
      $('.nar#'+i).append("<div class='panel panel-default'> <div class='panel-heading'>" + data['cats'][i]['name'] + "</div> <ul class='list-group' id='"+i+"'> </ul> </div>");
      for (var j = 0; j < data['cats'][i]['data'].length; j++){
        $('.nar#'+i+' .list-group').append('<li class="list-group-item">' + data['cats'][i]['data'][j]['name'] + ' <span class="badge">' + data['cats'][i]['data'][j]['count'] + '</span> </li>');
      }
    }

    var container = document.querySelector('.results');
    var msnry = new Masonry( container, {
      // options
      columnWidth: 350,
      itemSelector: '.nar'
    });

  })
  .fail(function()    { $("#sandbox").append( "<p>Error!</p>"           ); })
  .always(function()  { $("#sandbox").append( "<p>Finished.</p>"        ); });


});
</script>
</html>
